* 2025-11-30 - Audio file support for media imports

** Summary
Added support for audio files (.mp3, .wav, .ogg, .m4a, .aac, .flac) alongside images.
Audio files are now:
- Detected in org links and plain text
- Copied to assets folder
- Import statements generated
- But NO <Image> JSX generated (audio imports are for manual use with custom components)

** Usage in org files
Add audio file path as a link:
#+begin_example
[[/path/to/audio.mp3]]
#+end_example

The export will generate:
#+begin_example
import audioFile from '~/assets/images/posts/slug/audio.mp3';
#+end_example

Then manually use with AudioPlayer component in MDX.

** Files Modified
- `ox-astro-image-handlers.el`:
  - Added `org-astro--audio-extension-regexp` and `org-astro--media-extension-regexp`
  - Added `org-astro--audio-path-matches-p` and `org-astro--media-path-matches-p` helpers
  - Updated `org-astro--build-image-manifest` to use media matcher (images + audio)
  - Updated `org-astro--build-render-map` to skip JSX generation for audio files
  - Audio entries marked with `:audio t` for downstream identification

** Impact
- Audio files now get copied and imported automatically
- No breaking changes to existing image handling
- Manual component usage gives full control over audio player styling

* 2025-11-30 - Image credits/captions polish and reliability

** Summary
- Remove baked-in "Image:" labels; authors supply their own prefixes (e.g., "Generated With:").
- Use real image dimensions for PhotoSwipe links when available; omit attrs when unknown.
- Avoid credit/caption collisions by keying metadata on normalized relative paths (source root/source file), not just filenames.
- More reliable IMAGE-* association: scan forward from each image paragraph, skipping blanks, to pick up following IMAGE-CREDIT/CAPTION/PROMPT keywords.

** Files
- `ox-astro-helpers.el`: normalize-image-key, image-dimensions helper, format-image-component, image-component-for-record.
- `ox-astro-handlers.el`: collect-image-metadata-filter (forward scan, normalized keys).

** Impact
- Consistent wording controlled by content; no surprise prefixes.
- Better lightbox sizing; safer defaults when dimensions are unknown.
- Credits/captions stick to the correct image even when filenames repeat across folders.
- IMAGE-* keywords immediately after an image are picked up more reliably.

** Fixes
- Corrected paren balance in `org-astro--image-component-for-record` to restore clean load.

* 2025-11-26 Wednesday - Absolute Route Links & Narrowing Fix

** Summary
Addressed two major issues:
1.  **Narrowed Buffer Export**: Fixed a bug where exporting a narrowed buffer (e.g., a subtree) would fail to capture metadata or export the full content if the cursor was deep in the buffer.
2.  **Astro Routing**: Implemented an "Absolute Route Mode" for org-roam ID links to ensure they resolve to valid Astro URLs (e.g., `/notes/collection/id`) instead of broken relative MDX file paths (e.g., `../collection/id.mdx`).
3.  **Portability**: Removed hardcoded debug log paths from the source code, making the package distributable.

** Changes
- **`ox-astro.el`**:
  - Updated `org-astro-export-to-mdx` to unconditionally reset `point` to `(point-min)` before processing. This ensures exports always start from the beginning of the visible region (whether full buffer or narrowed subtree).
  - Replaced hardcoded debug log path with `org-astro-debug-log-file` custom variable.
- **`ox-astro-config.el`**:
  - Added `org-astro-id-link-base-path` custom variable (default: `nil`) to control absolute route generation.
- **`ox-astro-helpers.el`**:
  - Updated `org-astro-link` to check `org-astro-id-link-base-path`. If set, it computes the absolute route using the new `org-astro--compute-collection-id` helper. If nil, it falls back to relative MDX paths.
  - Updated debug helpers to use the new customizable log file variable.
- **Tests**:
  - Added `test/date-title-and-subtree-test.el` to regression test the narrowing/cursor fix.
  - Added `test-id-links.el` test case for absolute route mode.
  - Updated `test-debug.el` to use the portable log file variable.

** Impact
- **Reliable Subtree Exports**: Users can now export subtrees confidently regardless of cursor position.
- **Working Navigation**: Links between posts now work correctly in deployed Astro sites when `org-astro-id-link-base-path` is configured (e.g. to `/notes`).
- **Portability**: The package no longer depends on a specific user's filesystem for debug logging.

* 2025-11-26 Wednesday - Enhancements Documentation Updated

** Summary
Updated `suggested-enhancements.org` to reflect the current implementation status and prioritization of various features, including new opportunities from Astro 5.x image handling.

** Changes
- Reorganized `suggested-enhancements.org` into priority-based sections (High, Medium, Low Priority / Future Opportunities, Implemented / Completed).
- Marked "Remote Image Caching", "Absolute Route Mode for ID Links", and "PDF Asset Handling" as "Implemented / Completed".
- Added "Responsive Images" and "SVG Components" as "High Priority" opportunities, and "Picture Component Support" as "Low Priority / Future Opportunity", reflecting their status based on Astro 5.x features.

* 2025-12-01 - Exporter link handling hardening
** Summary
Fixed MDX parse failures caused by raw `<file:///...>` links when exporting `file+emacs`/`file+sys` links.
** Changes
- `ox-astro-helpers.el`: `org-astro-link` now rewrites non-image `file+emacs`/`file+sys` links to standard Markdown links (`file://...`), preventing invalid JSX autolinks in MDX output. Org buffers remain untouched during export.
** Impact
- Eliminates MDX parse errors from valid org file links (e.g., project references) without mutating source org files. 

* 2025-12-01 - Duplicate ID noise reduction
** Summary
Made duplicate org-roam ID handling deterministic and quiet during batch exports.
** Changes
- `ox-astro-helpers.el`: added scoring to prefer canonical sources (penalize “conflicted copy”/“ copy.org” paths) when the same ID appears in multiple files.
- Logging now defaults to a compact summary; set `OX_ASTRO_DUP_LOG_MODE=verbose` for per-ID detail.
** Impact
- Export output is readable again while still warning about ID collisions; exports pick stable winners for duplicated IDs without touching source org files.
- Strip PROPERTIES drawer output and org-roam boilerplate from MDX bodies, keeping IDs only in frontmatter (add property-drawer translator + final body cleanup of Links/Source lines). Addresses leaked `:ID:` lines like in journal/monday-february-12-2024.mdx.
