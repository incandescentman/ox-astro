#+TITLE: ox-astro Work Log
#+DATE: 2025-10-07

* 2025-10-22
** Session Summary
- Enabled `#+DESTINATION-FOLDER` as a synonym for `#+DESTINATION_FOLDER` across the exporter and tooling.
- Normalized destination keyword detection in helper scripts and refreshed documentation to advertise both forms.
- Logged the change in CHANGE-LOG with guidance on pending test coverage.
- Updated ID link guidance and fixtures to demonstrate Markdown links with preserved directory structure.
- Refreshed operational instructions with the Markdown link behavior for org-roam exports.

** Handoff

- [x] Destination keyword aliasing implemented: `ox-astro.el:97`, `ox-astro-helpers.el:211`
- [x] Auto-insert preserves user delimiter and absorptive docs updated: `ox-astro.el:309`, `README.org:82`, `docs/concept-map.org:80`
- [x] Tooling aware of both forms (`update-image-paths.el:72`, config docs)
- [x] Change log entry added: `CHANGE-LOG.org:5`
- [x] ID link docs/tests reinforced Markdown relative outputs: `docs/lab/org-roam-links.org`, `test-id-links.el`, `test-files/id-links/*`
- [x] Instructions updated to highlight Markdown link outputs: `docs/instructions.org:15`
- [x] Absolute-path destinations now populate ID map metadata: `ox-astro-helpers.el:181`, `test-id-links.el`
- [x] Source-root detection auto-falls back to the note's org-roam vault, keeping ID links working even when exporting from another profile: `ox-astro-helpers.el:339`

*IN-PROGRESS (Requires completion)*
- [ ] None

*CONTEXT FOR NEXT SESSION*
- Files touched: `ox-astro.el`, `ox-astro-helpers.el`, `update-image-paths.el`, documentation set
- Known unknowns: Automated regression suite beyond `test-id-links.el` not re-run; alias relies on shared keyword helper
- Recommendations: Export a sample Org file using `#+DESTINATION-FOLDER:` and run `emacs --batch -Q -l test-id-links.el -f ert-run-tests-batch-and-exit`

* 2025-10-10
** Session Summary
- Added DESCRIPTION keyword as fallback for EXCERPT in front matter generation
- Updated excerpt extraction logic to check EXCERPT first, then DESCRIPTION, then first paragraph
- Updated documentation in concept-map.org, design-architecture.org, and CHANGE-LOG.org

** Handoff

*COMPLETED (Safe to rely on)*
- [x] DESCRIPTION fallback implemented: `ox-astro-helpers.el:392-414`
- [x] Priority order: ASTRO_EXCERPT → EXCERPT → DESCRIPTION → first paragraph
- [x] Documentation updated: `docs/concept-map.org:103`, `docs/design-architecture.org:161`
- [x] Change log entry added: `CHANGE-LOG.org:5-29`

*IN-PROGRESS (Requires completion)*
- [ ] None

*CONTEXT FOR NEXT SESSION*
- Files touched: `ox-astro-helpers.el`, `docs/concept-map.org`, `docs/design-architecture.org`, `CHANGE-LOG.org`
- Known unknowns: None - feature is complete and self-contained
- Recommendations:
  - Test with an org file that has both DESCRIPTION and EXCERPT to verify priority works correctly
  - Consider whether README.org needs updating (currently skipped per user request)

* 2025-10-07
** Session Summary
- Updated table cell sanitization to wrap generic type signatures and normalize `<br>` tags for MDX compatibility.
- Normalized `<br>` tags during final output filtering to avoid Astro parse errors.
- Re-exported `guide-to-codex.org` to regenerate the Socratic blog post.

** Handoff

*COMPLETED (Safe to rely on)*
- [x] Generic type cells wrapped in inline code: `ox-astro-table-handlers.el`
- [x] `<br>` normalization added to final output filter: `ox-astro-handlers.el`
- [x] Export refreshed: `/Users/jay/Library/CloudStorage/Dropbox/github/astro-monorepo/apps/socratic/src/content/blog/guide-to-codex-cli.mdx`

*IN-PROGRESS (Requires completion)*
- [ ] None

*CONTEXT FOR NEXT SESSION*
- Files touched: `ox-astro-table-handlers.el`, `ox-astro-handlers.el`
- Known unknowns: Consider whether other HTML fragments (e.g., `<hr>`, `<img>`) need similar normalization.
- Recommendations: Review latest generated MDX in Astro dev server to confirm no additional JSX parse errors.
